{% extends 'movied/base.html' %}
{% load static %}
{% block content %}
    <section class="redirect">
        <div>
            <button id="btn"><i class="fa-solid fa-moon"></i></button>
        </div>
        <div id="container" class="redirect__forms">
            {% if user.is_authenticated %}
                <div class="foto__perfil-d">
                    <input type="checkbox" id="menu" class="container__btn">
                    <label for="menu">
                        {% if user.profile.profile_image %}
                        <img src="{{ user.profile.profile_image.url }}" class="foto__perfil" alt="foto de perfil">
                        {% else %}
                        <img src="https://movied-bucket.s3.amazonaws.com/static/media/default.jpg" class="foto__perfil" alt="foto de perfil">
                        {% endif %}
                        <span class="foto__perfil"></span>
                    </label>
                    <ul class="lista-menu">
                        <li class="lista-menu__item">
                            <a href="{% url 'profile' request.user.id %}" class="lista-menu__link">Profile</a>
                        </li>
                        <li class="lista-menu__item">
                            <a href="{% url 'logout' %}" class="lista-menu__link">Logout</a>
                        </li>
                    </ul>
                </div>
            {% else %}
            <a href="{% url 'login' %}" class="redirect__login">Login</a>
            <a href="{% url 'signup' %}" class="redirect__cadastro">Sign Up</a>
            {% endif %}
        </div>
        <div class="redirect__navbar">
            <a href="{% url 'index' %}" class="redirect__navbar__botao"><span class="fa fa-house"></span>Home</a>
            {% if notification %}
            <p class="new__notification"><i class="fa-solid fa-circle"></i></p>
            <a href="{% url 'notifications' request.user.id %}" class="redirect__navbar__botao"><span class="fa fa-bell"></span>Notifications</a>
            {% else %}
            <a href="{% url 'notifications' request.user.id %}" class="redirect__navbar__botao"><span class="fa fa-bell"></span>Notifications</a>
            {% endif %}
            <a href="{% url 'list' request.user.id %}" class="redirect__navbar__botao"><span class="fa fa-clipboard"></span>Lists</a>
            <a href="{% url 'suggestions' %}" class="redirect__navbar__botao"><span class="fa fa-lightbulb"></span>Suggestions</a>
            <a href="#" class="redirect__navbar__botao"><span class="fa fa-gear"></span>Preferences</a>
        </div> 
    </section>
    <div class="vl"></div>
    <section class="mid__section">
        {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li {% if message.tags %} class="warning" {% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
        <img class="logo" src="https://movied-bucket.s3.amazonaws.com/static/media/Design_sem_nome-removebg-preview.png" alt="logo do movied">
        <form class="form" action="{% url 'index' %}" method="POST">
        {% csrf_token %}
            <textarea class="posta" name="postagemt" id="postagem" placeholder="Comment your review" maxlength="400" style="height: auto;" required></textarea>
            <input type="submit" value="Post" name="postagem" class="form__submit">
        </form>
        <div class="tabela">
                {% if posts %}
                {% for postagem in posts %}
                {% if postagem.user.profile in user.profile.follows.all or postagem.user.profile == user.profile %}
                <div class="quem">
                {% if postagem.user.profile.profile_image %}
                <div id="container2">
                    <a href="{% url 'profile' postagem.user.id %}"><img class="foto__perfil" src="{{ postagem.user.profile.profile_image.url }}" class="foto__perfil-post" alt="foto de perfil"></a>
                </div>
                {% else %}
                <div id="container2">
                    <a href="{% url 'profile' postagem.user.id %}"><img src="https://movied-bucket.s3.amazonaws.com/static/media/default.jpg" class="foto__perfil" alt="foto de perfil"></a>
                </div>
                {% endif %}
                <p class="postagem__data"><strong>{{ postagem.user }}</strong> • {{ postagem.data_postagem }}</p>
                {% if postagem.user == request.user %}
                <a href="{% url 'deletar_postagem' postagem.id %}" class="remove__post"><i class="fa-solid fa-trash"></i></a>
                {% else %}
                <a href="{% url 'reportar_postagem' postagem.id %}" class="report__post"><i class="fa-solid fa-triangle-exclamation"></i></a>
                {% endif %}
                </div>
            <div class="paragrafo">
                <p class="postagem__paragrafo">{{ postagem.comentario }}</p>
            </div>
            {% if postagem.filmes.all %}
            {% for filme_item in postagem.filmes.all %}
            <div class="filme__container">
                {% if filme_item.Streaming %}
                <a href="{{filme_item.Streaming}}" target="_blank" rel="noopener noreferrer"><img class="imagem__filme" src="{{filme_item.Poster_Link}}" alt="Poster do Filme"></a>
                {% else %}
                <a><img class="imagem__filme" src="{{filme_item.Poster_Link}}" alt="Poster do Filme"></a>
                {% endif %}
              <li class="filme__item">
                <p class="filme__item-p">Name: {{filme_item.Series_Title}}</p>
                <p class="filme__item-p">Overview: {{filme_item.Overview}}</p>
                <p class="filme__item-p">Runtime: {{filme_item.Runtime}}</p>
                <p class="filme__item-p">IMDB Rating: {{filme_item.Rating}}</p>
                <p class="filme__item-p">Released: {{filme_item.Released_Year}}</p>
                <p class="filme__item-p">Genre: {{filme_item.Genre}}</p>
              </li>
            </div>
            {% endfor %}
            {% endif %}
            <div class="filme__opcoes">
                {% if user in postagem.likes.all %}
                <p data-post-id="{{ postagem.id }}" class="number__likes">{{postagem.number_of_likes}}</p><a href="{% url 'postagem_like' postagem.id %}" class="filme__like" data-post-id="{{ postagem.id }}" data-csrf-token="{{ csrf_token }}"><i class="fa-solid fa-heart"></i></a>
                {% else %}
                <p data-post-id="{{ postagem.id }}" class="number__likes">{{postagem.number_of_likes}}</p><a href="{% url 'postagem_like' postagem.id %}" class="filme__like" data-post-id="{{ postagem.id }}" data-csrf-token="{{ csrf_token }}"><i class="fa-regular fa-heart"></i></a>
                {% endif %}
                <p class="comentarios__length">{{ postagem.comentarios_postagem.all.count }}</p><a href="{% url 'comentarios' postagem.id %}" class="filme__comment"><i class="fa-regular fa-comment"></i></a>
                {% if user in postagem.list.all %}
                <p data-post-id="{{ postagem.id }}" class="number__save">{{ postagem.list.all.count }}</p><a href="#" data-post-id="{{ postagem.id }}" data-csrf-token="{{ csrf_token }}" class="filme__save"><i class="fa-solid fa-bookmark"></i></a>
                {% else %}
                <p data-post-id="{{ postagem.id }}" class="number__save">{{ postagem.list.all.count }}</p><a data-post-id="{{ postagem.id }}" data-csrf-token="{{ csrf_token }}" href="{% url 'save_movie' postagem.id %}" class="filme__save"><i class="fa-regular fa-bookmark"></i></a>
                {% endif %}
            </div>
        {% for comentario in postagem.comentarios_postagem.all %}
        {% if comentario.user.profile in user.profile.follows.all or comentario.user.profile == user.profile %}
            <div class="comentario">
                <div class="quem2">
                {% if comentario.user.profile.profile_image %}
                <div id="container2">
                    <a href="{% url 'profile' comentario.user.id %}"><img class="foto__perfil" src="{{ comentario.user.profile.profile_image.url }}" class="foto__perfil-post" alt="foto de perfil"></a>
                </div>
                {% else %}
                <div id="container2">
                    <a href="{% url 'profile' comentario.user.id %}"><img src="https://movied-bucket.s3.amazonaws.com/static/media/default.jpg" class="foto__perfil" alt="foto de perfil"></a>
                </div>
                {% endif %}
                <p class="comentario__data"><strong>{{ comentario.user }}</strong> • {{ comentario.data_comentario }}</p>
                {% if comentario.user == request.user %}
                <a href="{% url 'deletar_comentario' comentario.id %}" class="remove__post2"><i class="fa-solid fa-trash"></i></a>
                {% else %}
                <a href="{% url 'reportar_comentario' comentario.id %}" class="report__post2"><i class="fa-solid fa-triangle-exclamation"></i></a>
                {% endif %}
                </div>
            <div class="paragrafo2">
                <p class="postagem__paragrafo">{{ comentario.comentario }}</p>
            </div>
            <div class="filme__opcoes2">
            </div>
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% endfor %}
        {% else %}
        {% endif %}
    </div>
    </section>
    <div class="vl2"></div>
    <section>
        <form class="form2" action="{% url 'search' %}" method="POST">
            {% csrf_token %}
            <input type="text" class="busca" name="query" id="query" maxlength="30" placeholder="Search" required>
            <input type="submit" id="search" class="input__search">
            <label class="search" for="search">
                <i class="fa-solid fa-magnifying-glass"></i>
            </label>
        </form>
        <div class="rt">
            <h3 class="rt__texto">Trending Movies</h3>
            <div class="tabela-trend" id="filme_dinamico">
            {% for movie in top_posts %}
            {% if movie %}
                <div class="filme__trend">
                    <img class="imagem__filme-trend" src="{{movie.Poster_Link}}" alt="Poster do Filme">
                    <li class="filme__item-trend">
                        <p class="filme__item-p-trend">Name: {{movie.Series_Title}}</p>
                        <p class="filme__item-p-trend">Rating: {{movie.Rating}}</p>
                        <p class="filme__item-p-trend">Released: {{movie.Released_Year}}</p>
                    </li>
                </div>
            {% endif %}
            {% endfor %}
            </div>
            <div class="trend__options">
                <form id="form__trend" method="get" action="{% url 'index' %}">
                    <i class="fa-solid fa-earth-americas"></i>
                    <label class="switch">
                        <input type="checkbox" id="slide-trend" name="include_follows">
                        <span class="slider round"></span>
                    </label>
                    <i class="fa-solid fa-users"></i>
                </form>
            </div>
        </div>
        <div class="rt3">
            <h3 class="rt3__texto">Recommended Users</h3>
            {% if users %}
            {% for user in users %}
            <div class="user_recomended">
                {% if user.profile.profile_image %}
                <a href="{% url 'profile' user.id %}"><img class="foto__perfil-rc" src="{{ user.profile.profile_image.url }}" alt="foto de perfil"></a>
                {% else %}
                <a href="{% url 'profile' user.id %}"><img src="https://movied-bucket.s3.amazonaws.com/static/media/default.jpg" class="foto__perfil-rc" alt="foto de perfil"></a>
                {% endif %}
                <p class="user_username">{{user.username}}</p>
                <form method="POST">
                    {% csrf_token %}
                    <button class="botao_follow2" name="follow" value="{{ user.id }}" type="submit">Follow</button>
                </form>
            </div>
            {% endfor %}
            {% endif %}
        </div>
    </section>
    <script src="{% static 'app/api.js' %}"></script>
{% endblock %}